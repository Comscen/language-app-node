<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>ARC</title>

    <%- include("./partials/stylesheets.ejs") %>

    <link rel="stylesheet" href="/css/login-form.css">
</head>

<body>
    
    <%- include("./partials/navigation.ejs") %>
    
    <div class="d-flex flex-column justify-content-center" id="login-box">

        <div class="login-box-header">
            <h4 style="color:rgb(139,139,139);margin-bottom:0px;font-weight:400;font-size:27px;">Logowanie</h4>
        </div>
        <% if (typeof error != 'undefined') { %>
            <div class="alert alert-danger" role="alert"><span><%= error %></span></div>
        <% } %>
        <div class="login-box-content">

            <form id="oauth-form" action="/auth/login/oauth" method="POST">
                <input id="token-input" type="hidden" name="idToken"></input>
            </form>

            <div class="fb-login box-shadow">
                <a id="facebook-login" class="d-flex flex-row align-items-center social-login-link" href="#" onclick="loginWithFacebook()">
                    <i class="fa fa-facebook" style="margin-left:0px;padding-right:20px;padding-left:22px;width:56px;"></i>Zaloguj z użyciem Facebooka
                </a>
                
            </div>

            <div class="tw-login box-shadow">
                <a id="twitter-login" class="d-flex flex-row align-items-center social-login-link" href="#" onclick="loginWithTwitter()">
                    <i class="fa fa-twitter" style="margin-left:0px;padding-right:20px;padding-left:22px;width:56px;"></i>Zaloguj z użyciem Twittera
                </a>
            </div>

            <div class="gp-login box-shadow">
                <a id="google-login" class="d-flex flex-row align-items-center social-login-link" style="margin-bottom:10px;" href="#" onclick="loginWithGoogle()" >
                    <i class="fa fa-google" style="color:rgb(255,255,255);width:56px;"></i>Zaloguj z użyciem Google
                </a>
            </div>

        </div>

        <div class="d-flex flex-row align-items-center login-box-seperator-container">
            <div class="login-box-seperator"></div>
            <div class="login-box-seperator-text">
                <p style="margin-bottom:0px;padding-left:10px;padding-right:10px;font-weight:400;color:rgb(201,201,201);">lub</p>
            </div>
            <div class="login-box-seperator"></div>
        </div>

        <form method="POST">
            <div class="email-login" style="background-color:#ffffff;">
                <input name="email" type="email" class="email-imput form-control" style="margin-top:10px;" required="true" placeholder="E-mail" minlength="6">
                <input name="password" type="password" class="password-input form-control" style="margin-top:10px;" required="true" placeholder="Hasło" minlength="5">
            </div>
                
            <div class="submit-row" style="margin-bottom: 8px;padding-top: 0px;">
                <input class="btn btn-primary btn-block box-shadow" id="submit-id-submit" value="Zaloguj" type="submit" style="background: rgb(86,198,198);"></input>
            </div>
        </form>

        <div id="login-box-footer" style="padding:10px 20px;padding-bottom:23px;padding-top:18px;">
            <p style="margin-bottom:0px;">Nie masz jeszcze konta?<a id="register-link" href="/auth/register">Zarejestruj się!</a></p>
        </div>

    </div>

    <%- include("./partials/footer.ejs") %>

    <%- include("./partials/scripts.ejs") %>

    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>

    <script>

        const firebaseConfig = {
            apiKey: "AIzaSyDplOHnr09YHlR0JbA4Romt6DywRswHPZY",
            authDomain: "projekt-arc.firebaseapp.com",
            databaseURL: "https://projekt-arc.firebaseio.com",
            storageBucket: "projekt-arc.appspot.com"
        };

        firebase.initializeApp(firebaseConfig);
        
        async function loginWithGoogle(event){
            var provider = new firebase.auth.GoogleAuthProvider();
            await firebase.auth().signInWithPopup(provider);
            await firebase.auth().currentUser.getIdToken().then(idToken => {
                document.getElementById('token-input').value = idToken;
                document.getElementById('oauth-form').submit();
            });
        }

        async function loginWithFacebook(event){
            var provider = new firebase.auth.FacebookAuthProvider();
            await firebase.auth().signInWithPopup(provider);
            await firebase.auth().currentUser.getIdToken().then(idToken => {
                console.log(idToken)
                document.getElementById('token-input').value = idToken;
                document.getElementById('oauth-form').submit();
            });
        }

        async function loginWithTwitter(event){
            var provider = new firebase.auth.TwitterAuthProvider();
            await firebase.auth().signInWithPopup(provider);
            await firebase.auth().currentUser.getIdToken().then(idToken => {
                console.log(idToken)
                document.getElementById('token-input').value = idToken;
                document.getElementById('oauth-form').submit();
            });
        }

      </script>

</body>

</html>